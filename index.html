<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Roleta Percentual</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    #canvas {
      border: 5px solid #333;
      border-radius: 50%;
      background: white;
      transition: transform 4s ease-out;
    }
    #pointer {
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-bottom: 30px solid black;
      margin: 0 auto 10px auto;
    }
    .color-preview {
      width: 20px;
      height: 20px;
      display: inline-block;
      margin-right: 5px;
      border: 1px solid #000;
    }
  </style>
</head>
<body class="bg-light">
  <div class="container py-4">
    <h1 class="text-center mb-4">Roleta Percentual</h1>

    <div id="pointer"></div>
    <canvas id="canvas" width="400" height="400" class="mx-auto d-block"></canvas>

    <form id="configForm" class="mt-4">
      <div id="inputs">
        <!-- Primeira opÃ§Ã£o jÃ¡ visÃ­vel -->
        <div class="row align-items-center mb-2">
          <div class="col-auto">
            <span class="color-preview" style="background:#FF6384;"></span>
          </div>
          <div class="col-md-5">
            <input type="text" class="form-control" placeholder="Nome da opÃ§Ã£o" value="a" required />
          </div>
          <div class="col-md-3">
            <input type="number" class="form-control" placeholder="%" value="50" required />
          </div>
        </div>
        <div class="row align-items-center mb-2">
          <div class="col-auto">
            <span class="color-preview" style="background:#FFCE56;"></span>
          </div>
          <div class="col-md-5">
            <input type="text" class="form-control" placeholder="Nome da opÃ§Ã£o" value="b" required />
          </div>
          <div class="col-md-3">
            <input type="number" class="form-control" placeholder="%" value="50" required />
          </div>
        </div>
      </div>

      <div class="d-flex gap-2 mb-3">
        <button type="button" class="btn btn-secondary" onclick="addInput()">+ Adicionar opÃ§Ã£o</button>
        <button type="submit" class="btn btn-primary">Gerar Roleta</button>
      </div>
    </form>

    <div class="text-center">
      <button class="btn btn-success" onclick="girar()">ðŸŽ¯ Girar</button>
    </div>

    <div id="resultado" class="alert alert-info mt-3 d-none text-center"></div>
  </div>

  <script>
    const cores = ['#FF6384', '#FFCE56', '#36A2EB', '#4BC0C0', '#9966FF', '#FF9F40', '#00a86b', '#8B0000', '#8A2BE2', '#FF4500'];
    let segmentos = [];
    let angulos = [];

    function addInput() {
      const count = document.querySelectorAll('#inputs .row').length;
      const color = cores[count % cores.length];
      const div = document.createElement('div');
      div.className = 'row align-items-center mb-2';
      div.innerHTML = `
        <div class="col-auto">
          <span class="color-preview" style="background:${color};"></span>
        </div>
        <div class="col-md-5">
          <input type="text" class="form-control" placeholder="Nome da opÃ§Ã£o" required>
        </div>
        <div class="col-md-3">
          <input type="number" class="form-control" placeholder="%" required>
        </div>
      `;
      document.getElementById('inputs').appendChild(div);
    }

    document.getElementById("configForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const inputs = document.querySelectorAll("#inputs .row");
      segmentos = [];
      let total = 0;

      inputs.forEach((div, i) => {
        const label = div.querySelector("input[type='text']").value.trim();
        const percent = parseFloat(div.querySelector("input[type='number']").value);
        const color = cores[i % cores.length];
        if (label && percent > 0) {
          total += percent;
          segmentos.push({ label, percent, color });
        }
      });

      if (total !== 100) {
        alert("A soma das porcentagens deve ser exatamente 100%.");
        return;
      }

      desenharRoleta(0);
      document.getElementById("resultado").classList.add("d-none");
    });

    function desenharRoleta(rotation = 0) {
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const radius = 180;

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.save();
      ctx.translate(centerX, centerY);
      ctx.rotate(rotation * Math.PI / 180);
      ctx.translate(-centerX, -centerY);

      let startAngle = 0;
      angulos = [];

      segmentos.forEach(seg => {
        const angle = (seg.percent / 100) * 2 * Math.PI;
        const endAngle = startAngle + angle;
        angulos.push({ label: seg.label, start: startAngle, end: endAngle });

        // Desenhar fatia
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.arc(centerX, centerY, radius, startAngle, endAngle);
        ctx.closePath();
        ctx.fillStyle = seg.color;
        ctx.fill();

        // Escrever o nome
        const midAngle = (startAngle + endAngle) / 2;
        const textX = centerX + Math.cos(midAngle) * radius * 0.6;
        const textY = centerY + Math.sin(midAngle) * radius * 0.6;
        ctx.save();
        ctx.fillStyle = "#fff";
        ctx.font = "bold 14px sans-serif";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(seg.label, textX, textY);
        ctx.restore();

        startAngle = endAngle;
      });

      ctx.restore();
    }

    function girar() {
      const canvas = document.getElementById("canvas");
      const totalRotation = 360 * 5 + Math.random() * 360;
      canvas.style.transform = `rotate(${totalRotation}deg)`;

      setTimeout(() => {
        const finalAngle = (360 - (totalRotation % 360)) % 360;
        const angleRad = finalAngle * Math.PI / 180;
        const resultado = angulos.find(a => angleRad >= a.start && angleRad < a.end);
        const msg = resultado ? `ðŸŽ‰ Resultado: ${resultado.label}` : "Erro ao calcular resultado.";
        const box = document.getElementById("resultado");
        box.textContent = msg;
        box.classList.remove("d-none");
      }, 4200);
    }
  </script>
</body>
</html>
